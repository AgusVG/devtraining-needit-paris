<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_email">
    <sys_script_email action="INSERT_OR_UPDATE">
        <name>CountOverdueNeedItTasksAssignedTo</name>
        <new_lines_to_html>false</new_lines_to_html>
        <script><![CDATA[(function runMailScript( /* GlideRecord */ current, /* TemplatePrinter */ template, /* Optional EmailOutbound */ email, /* Optional GlideRecord */ email_action, /* Optional GlideRecord */ event) {

    // Construct a GlideRecord query to find all NeedIt Task records with Due date field values in the past for the same Assigned to. The records cannot be in the Closed state.
    var rightNow = new GlideDateTime();

    var overdueNITasks = new GlideRecord('x_58872_needit_needit_task');
    overdueNITasks.addQuery('due_date', '<=', rightNow);
    overdueNITasks.addQuery('state', '<', 3);
    overdueNITasks.addQuery('assigned_to', current.assigned_to);

    overdueNITasks.query();

    // Print to the Message field on a notification
    if (overdueNITasks.getRowCount() > 0) {
		while(overdueNITasks.next()) {
			var baseURL = gs.getProperty("glide.servlet.uri");
			template.print("NeedIt Task Number: " + "<a href=" + baseURL + overdueNITasks.getLink() +">" + overdueNITasks.getValue('number') + "</a> <br>");
			//template.print("NeedIt Task: " + overdueNITasks.getValue('number') + '<br>');
			//template.print("In addition to this overdue NeedIt Task, you have " + (overdueNITasks.getRowCount() - 1) + " more overdue NeedIt Tasks.");
		}
	}

})(current, template, email, email_action, event);]]></script>
        <sys_class_name>sys_script_email</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2021-03-02 21:44:46</sys_created_on>
        <sys_id>fe410a57db2a601009e52737489619b8</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>CountOverdueNeedItTasksAssignedTo</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_script_email_fe410a57db2a601009e52737489619b8</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-03-05 19:35:41</sys_updated_on>
    </sys_script_email>
</record_update>
